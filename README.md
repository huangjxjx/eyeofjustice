# 正义之眼 (Eye of Justice)

## 项目简介

正义之眼是一个基于RFID和语音识别的智能监测霸凌行为系统。该系统通过先进的技术手段，实时监测校园环境中的异常行为，为校园安全提供智能化解决方案。

## 核心功能

### 1. 用户管理系统
- **登录注册**: 支持管理员、教师、学生等多种角色注册登录
- **权限管理**: 基于角色的访问控制，确保数据安全
- **用户档案**: 完整的用户信息管理

### 2. RFID监测系统
- **身份识别**: 通过RFID标签识别学生身份
- **位置追踪**: 实时记录学生在校园内的活动轨迹
- **异常检测**: 识别异常聚集行为和可疑活动

### 3. 语音识别系统
- **实时监听**: 监测环境中的语音内容
- **关键词识别**: 识别霸凌相关词汇和威胁性语言
- **情感分析**: 分析语音中的情感状态

### 4. 智能预警系统
- **实时预警**: 发现异常行为时立即发出预警
- **事件记录**: 详细记录所有监测到的事件
- **数据分析**: 提供数据统计和分析报告

### 5. 关键词管理系统
- **个性化关键词**: 每个用户可以设置自己的霸凌关键词
- **实时更新**: 支持动态添加和删除关键词
- **智能匹配**: 语音识别系统会根据用户的关键词进行匹配

## 技术架构

### 前端技术栈
- **Vue 3**: 现代化的前端框架
- **Element Plus**: 企业级UI组件库
- **Pinia**: 状态管理
- **Vue Router**: 路由管理

### 后端技术栈
- **Node.js**: 服务器运行环境
- **Express**: Web应用框架
- **MongoDB**: 数据库存储
- **Socket.io**: 实时通信

### 硬件集成
- **RFID读写器**: 身份识别和位置追踪
- **麦克风阵列**: 语音采集
- **摄像头**: 视频监控

## 项目结构

```
eyeofjustice/
├── public/                 # 静态资源
├── src/
│   ├── api/               # API接口
│   │   ├── user.js        # 用户相关接口
│   │   ├── keywords.js    # 关键词管理接口
│   │   └── test.js        # API测试文件
│   ├── assets/            # 资源文件
│   ├── components/        # 公共组件
│   │   └── KeywordManager.vue  # 关键词管理组件
│   ├── views/             # 页面组件
│   │   ├── Login.vue      # 登录页面
│   │   ├── Register.vue   # 注册页面
│   │   ├── Dashboard.vue  # 主控制台
│   │   └── Monitor.vue    # 监测页面
│   ├── router/            # 路由配置
│   ├── stores/            # 状态管理
│   ├── utils/             # 工具函数
│   ├── App.vue            # 根组件
│   └── main.js            # 入口文件
├── package.json           # 项目配置
└── README.md              # 项目说明
```

## 安装和运行

### 环境要求
- Node.js >= 16.0.0
- npm >= 8.0.0

### 安装依赖
```bash
npm install
```

### 开发环境运行
```bash
npm run serve
```

### 生产环境构建
```bash
npm run build
```

### 代码检查
```bash
npm run lint
```

## 使用说明

### 1. 用户注册
- 访问注册页面
- 填写用户信息（姓名、邮箱、密码、角色等）
- 验证邮箱后完成注册

### 2. 用户登录
- 输入邮箱和密码
- 选择记住登录状态（可选）
- 点击登录按钮

### 3. 系统功能
- **管理员**: 可以查看所有数据、管理用户、配置系统参数
- **教师**: 可以查看班级数据、接收预警信息、管理学生档案、设置关键词
- **学生**: 可以查看个人信息、报告事件、设置个人关键词

### 4. 关键词管理使用说明
- **添加关键词**: 在监测页面点击"添加霸凌关键词"按钮，输入关键词后确认添加
- **删除关键词**: 在关键词列表中点击关键词右侧的关闭按钮即可删除
- **关键词同步**: 系统会自动同步用户的关键词设置，无需手动刷新
- **注意事项**: 
  - 关键词会用于语音识别匹配，建议设置准确、具体的霸凌相关词汇
  - 删除关键词会立即从数据库中移除，操作不可撤销
  - 如果删除失败，请检查网络连接和后端服务状态

## API接口说明

### 用户管理接口
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `POST /api/auth/logout` - 用户登出
- `GET /api/user/profile` - 获取用户信息

### 监测数据接口
- `GET /api/monitor/events` - 获取事件列表
- `POST /api/monitor/report` - 报告事件
- `GET /api/monitor/statistics` - 获取统计数据

### RFID数据接口
- `GET /api/rfid/locations` - 获取位置数据
- `POST /api/rfid/update` - 更新RFID数据

### 语音识别接口
- `POST /api/voice/analyze` - 语音分析
- `GET /api/voice/alerts` - 获取语音预警

### 关键词管理接口
- `GET /keywords/user/{user_id}` - 根据用户ID获取关键词列表
- `POST /keywords/` - 创建新的关键词
- `DELETE /keywords/{id}` - 删除关键词（根据关键词ID）

## 配置说明

### 环境变量
```env
VUE_APP_API_BASE_URL=http://localhost:3000
VUE_APP_RFID_ENABLED=true
VUE_APP_VOICE_ENABLED=true
VUE_APP_DEBUG_MODE=false
```

### 系统参数
- **RFID检测频率**: 5秒/次
- **语音分析间隔**: 1秒/次
- **预警阈值**: 可配置
- **数据保留时间**: 30天

## 安全说明

- 所有用户密码使用bcrypt加密存储
- API接口使用JWT令牌认证
- 敏感数据传输使用HTTPS加密
- 定期备份重要数据

## 开发指南

### 关键词管理功能开发
1. **API接口**: 所有关键词相关的API接口都在 `src/api/keywords.js` 中定义
2. **组件使用**: 可以使用 `KeywordManager.vue` 组件在任何页面中集成关键词管理功能
3. **状态管理**: 用户信息通过Pinia store管理，使用 `useUserStore()` 获取用户ID
4. **错误处理**: 所有API调用都包含完整的错误处理和用户提示

### 测试API接口
```javascript
// 在浏览器控制台中运行以下代码测试API
import { testKeywordsAPI } from '@/api/test'
testKeywordsAPI()
```

### 调试用户信息问题
如果遇到"用户信息不存在"的错误，可以：

1. **访问调试页面**: 在浏览器中访问 `http://localhost:8088/debug`
2. **查看控制台日志**: 打开浏览器开发者工具，查看Console标签页
3. **手动测试**: 在调试页面中可以：
   - 查看当前用户信息状态
   - 清除用户信息
   - 设置测试用户
   - 测试关键词API

4. **在控制台中调试**:
```javascript
// 导入调试工具
import { debugUserInfo, clearAllUserInfo, setTestUserInfo } from '@/utils/debug'

// 查看用户信息
debugUserInfo()

// 清除用户信息
clearAllUserInfo()

// 设置测试用户
setTestUserInfo()
```

## 故障排除

### 常见问题
1. **登录失败**: 检查邮箱和密码是否正确
2. **页面加载慢**: 检查网络连接和服务器状态
3. **数据不显示**: 检查API接口是否正常
4. **无法访问dashboard**: 
   - 确保已经登录（localStorage中有userInfo）
   - 检查端口配置是否正确（默认8088）
   - 清除浏览器缓存后重试
5. **关键词管理问题**:
   - 确保后端API服务正在运行（http://127.0.0.1:8000）
   - 检查用户是否已登录且用户信息完整
   - 查看浏览器控制台是否有API错误信息
   - 确认关键词格式正确（不能为空或重复）

### 端口配置
- 开发服务器端口：8088
- 访问地址：`http://localhost:8088`
- 如果修改端口，需要重启开发服务器

### 登录状态管理
- 用户信息存储在localStorage中的'userInfo'键
- 登录后会自动跳转到dashboard页面
- 如果无法访问dashboard，请重新登录

### 日志查看
- 前端日志: 浏览器开发者工具
- 后端日志: 服务器控制台
- 错误报告: 系统会自动收集错误信息

## 更新日志

### v1.0.0 (2024-01-01)
- 初始版本发布
- 基础登录注册功能
- RFID和语音识别集成

## 联系方式

- 项目维护者: [您的姓名]
- 邮箱: [您的邮箱]
- 技术支持: [技术支持邮箱]

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 数据分析功能说明

### 霸凌事件趋势统计
- **功能用途**：
  - 展示用户在指定日期区间内，每天的霸凌事件数量趋势。
- **使用方法**：
  - 进入“数据分析”页面，选择日期区间，系统自动统计并展示趋势曲线。
  - 未选择日期时，默认展示最近7天数据。
- **接口说明**：
  - `POST /alerts/count-by-date`
  - **请求参数**：
    - `user_id`：当前用户ID（自动获取）
    - `start_date`：起始日期（YYYY-MM-DD）
    - `end_date`：结束日期（YYYY-MM-DD）
  - **返回值**：
    - 数组，每项包含：
      - `date`：日期（YYYY-MM-DD）
      - `count`：当天事件数量
    - 示例：
      ```json
      [
        { "date": "2025-07-01", "count": 1 },
        { "date": "2025-07-02", "count": 1 }
      ]
      ```
- **注意事项**：
  - 横坐标与所选日期区间严格对应，未返回的日期自动补零。
  - 切换日期区间会自动刷新数据。
  - 当前用户ID由系统自动获取，无需手动输入。

### 霸凌事件类型分布统计
- **功能用途**：
  - 展示用户在指定日期区间内，不同识别类型（如RFID、语音）的霸凌事件数量分布。
- **使用方法**：
  - 进入“数据分析”页面，选择日期区间，系统自动统计并展示类型分布饼图。
  - 未选择日期时，默认展示最近7天数据。
- **接口说明**：
  - `POST /alerts/count-by-type`
  - **请求参数**：
    - `user_id`：当前用户ID（自动获取）
    - `start_date`：起始日期（YYYY-MM-DD）
    - `end_date`：结束日期（YYYY-MM-DD）
  - **返回值**：
    - 对象，key为类型名称，value为数量。例如：
      ```json
      {
        "语音霸凌检测": 5,
        "RFID霸凌检测": 0
      }
      ```
- **注意事项**：
  - 饼图类型与后端返回的类型名称一一对应。
  - 切换日期区间会自动刷新类型分布。
  - 当前用户ID由系统自动获取，无需手动输入。
